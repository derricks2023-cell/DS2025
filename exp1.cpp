#include <iostream>
#include <vector>
#include <stack>
#include <algorithm>
#include <cmath>
using namespace std;

/*********************** 工具函数 ***********************/
void printLine() {
    cout << "--------------------------------------------------\n";
}

/*********************** 第 1 题：复数向量 ***********************/
struct Complex {
    int a; // 实部
    int b; // 虚部
};

// 打印复数数组
void printComplexVector(const vector<Complex> &v) {
    for (auto &x : v)
        cout << "(" << x.a << ", " << x.b << ")  ";
    cout << "\n";
}

// 按模长排序（隐藏模长展示）
bool cmpComplex(const Complex &x, const Complex &y) {
    return (x.a * x.a + x.b * x.b) < (y.a * y.a + y.b * y.b);
}

void part1() {
    cout << "==================== 第 1 题：复数向量操作 ====================\n\n";

    // 示例1：排序
    {
        cout << ">>> 示例 1：排序\n";
        vector<Complex> v = {{3,4},{1,-2},{0,5},{-4,-3}};
        cout << "原向量:\n"; printComplexVector(v);
        sort(v.begin(), v.end(), cmpComplex);
        cout << "排序后:\n"; printComplexVector(v); cout << "\n";
    }

    // 示例2：插入 + 删除 + 查找
    {
        cout << ">>> 示例 2：插入 + 删除 + 查找\n";
        vector<Complex> v = {{2,1},{-1,3}};
        cout << "原向量:\n"; printComplexVector(v);

        cout << "插入 (4, -2)\n";
        v.push_back({4,-2}); printComplexVector(v);

        cout << "查找 (2, 1)\n";
        auto it = find_if(v.begin(), v.end(), [](Complex c){
            return c.a==2 && c.b==1;
        });
        if(it != v.end()) cout << "找到该元素！\n";

        cout << "删除 (2, 1)\n";
        v.erase(it); printComplexVector(v); cout << "\n";
    }

    // 示例3：唯一化 + 取前 m 大复数
    {
        cout << ">>> 示例 3：唯一化 + 前 m 大复数\n";
        vector<Complex> v = {{3,3},{1,2},{3,3},{-2,4},{-2,4},{0,0}};
        cout << "原向量:\n"; printComplexVector(v);

        sort(v.begin(), v.end(), [](Complex x, Complex y){
            if(x.a == y.a) return x.b < y.b;
            return x.a < y.a;
        });

        v.erase(unique(v.begin(), v.end(), [](Complex x, Complex y){
            return (x.a==y.a && x.b==y.b);
        }), v.end());

        cout << "唯一化后:\n"; printComplexVector(v);

        sort(v.begin(), v.end(), cmpComplex);
        int m = 3;
        cout << "取前 " << m << " 大复数:\n";
        for(int i = (int)v.size()-1; i >= (int)v.size()-m; i--)
            cout << "(" << v[i].a << ", " << v[i].b << ")  ";
        cout << "\n\n";
    }
}

/*********************** 第 2 题：表达式求值（栈） ***********************/
int priority(char op) {
    if(op=='!') return 3;
    if(op=='^') return 2;
    if(op=='*' || op=='/') return 1;
    if(op=='+' || op=='-') return 0;
    return -1;
}

int factorial(int n){
    int ans=1;
    for(int i=1;i<=n;i++) ans*=i;
    return ans;
}

int apply(int a, int b, char op){
    switch(op){
        case '+': return b + a;
        case '-': return b - a;
        case '*': return b * a;
        case '/': return b / a;
        case '^': return pow(b, a);
    }
    return 0;
}

int eval(string exp){
    stack<int> nums;
    stack<char> ops;

    for(int i=0;i<exp.size();i++){
        if(isdigit(exp[i])){
            int val=0;
            while(i<exp.size() && isdigit(exp[i])){
                val=val*10 + exp[i]-'0';
                i++;
            }
            i--;
            nums.push(val);
        } else if(exp[i] == '('){
            ops.push('(');
        } else if(exp[i] == ')'){
            while(ops.top()!='('){
                char op = ops.top(); ops.pop();
                if(op=='!'){
                    int a = nums.top(); nums.pop();
                    nums.push(factorial(a));
                }else{
                    int a=nums.top(); nums.pop();
                    int b=nums.top(); nums.pop();
                    nums.push(apply(a,b,op));
                }
            }
            ops.pop();
        } else {
            while(!ops.empty() && ops.top()!='(' &&
                  priority(ops.top()) >= priority(exp[i])){
                char op = ops.top(); ops.pop();
                if(op=='!'){
                    int a = nums.top(); nums.pop();
                    nums.push(factorial(a));
                }else{
                    int a=nums.top(); nums.pop();
                    int b=nums.top(); nums.pop();
                    nums.push(apply(a,b,op));
                }
            }
            ops.push(exp[i]);
        }
    }

    while(!ops.empty()){
        char op = ops.top(); ops.pop();
        if(op=='!'){
            int a = nums.top(); nums.pop();
            nums.push(factorial(a));
        }else{
            int a=nums.top(); nums.pop();
            int b=nums.top(); nums.pop();
            nums.push(apply(a,b,op));
        }
    }
    return nums.top();
}

void part2(){
    cout << "==================== 第 2 题：表达式求值 ====================\n\n";
    vector<string> exps = {
        "1+2", "2*3+4", "(2+3)*4", "5!-4", "2^3+1",
        "10/(2+3)", "3+4*2/(1-5)", "(3+2)!-1", "6/3*2+5", "8-3^2+1"
    };

    for(int i=0;i<exps.size();i++){
        cout << "示例 " << i+1 << ": " << exps[i] << "\n";
        cout << "结果 = " << eval(exps[i]) << "\n\n";
    }
}

/*********************** 第 3 题：最大矩形面积 ***********************/
int largestRectangle(vector<int> h){
    stack<int> st;
    h.push_back(0);
    int maxA = 0;
    for(int i=0;i<h.size();i++){
        while(!st.empty() && h[st.top()] > h[i]){
            int height = h[st.top()]; st.pop();
            int left = st.empty()? -1 : st.top();
            maxA = max(maxA, height * (i - left - 1));
        }
        st.push(i);
    }
    return maxA;
}

void part3(){
    cout << "==================== 第 3 题：最大矩形面积 ====================\n\n";
    vector<vector<int>> tests = {
        {6,2,5,4,5,1,6},
        {2,1,5,6,2,3},
        {4,4,4,4}
    };

    for(int i=0;i<tests.size();i++){
        cout << "示例 " << i+1 << ":\n输入 heights = [ ";
        for(int x : tests[i]) cout << x << " ";
        cout << "]\n";
        cout << "最大矩形面积 = " << largestRectangle(tests[i]) << "\n\n";
    }
}

/*********************** 主函数 ***********************/
int main(){
    part1(); printLine();
    part2(); printLine();
    part3();
    return 0;
}

